<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Dashboard - SocioServe</title>
    <style>
   * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #333;
    line-height: 1.6;
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 50px;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.navbar .logo {
    font-size: 24px;
    font-weight: bold;
    color: #0a1a2f;
}

.nav-links a {
    text-decoration: none;
    color: #555;
    margin-left: 25px;
    font-weight: 500;
    transition: color 0.3s;
}

.nav-links a:hover {
    color: #0a1a2f;
}

.dashboard-container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
}

.events-section h2, .activity-section h2 {
    color: #0a1a2f;
    margin-bottom: 20px;
    font-size: 24px;
    font-weight: bold;
}

/* Dashboard Hero Styles */
.dashboard-hero {
    background: linear-gradient(135deg, #0a1a2f 0%, #142b4f 100%);
    color: white;
    padding: 40px;
    border-radius: 16px;
    margin-bottom: 30px;
    box-shadow: 0 8px 32px rgba(10, 26, 47, 0.3);
    position: relative;
    overflow: hidden;
}

.dashboard-hero::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
}

.hero-content h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 10px;
    line-height: 1.2;
}

.hero-content .organization-name {
    font-size: 1.8rem;
    font-weight: 600;
    color: #64b5f6;
    margin-bottom: 15px;
    display: block;
}

.hero-content .tagline {
    font-size: 1.2rem;
    opacity: 0.9;
    margin-bottom: 20px;
    line-height: 1.5;
    max-width: 600px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 12px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

.quick-actions {
    display: flex;
    gap: 15px;
    margin-top: 25px;
    flex-wrap: wrap;
}

.action-btn {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    padding: 12px 24px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    cursor: pointer;
    border: none;
    font-size: 14px;
}

.action-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
}

.action-btn.primary {
    background: #4CAF50;
    border-color: #4CAF50;
}

.action-btn.primary:hover {
    background: #45a049;
}

/* Event Card Styles */
.event-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border-left: 4px solid #4CAF50;
}

.event-card.cancelled {
    border-left-color: #f44336;
}

.event-card.completed {
    border-left-color: #2196F3;
}

.organization-badge {
    background: #e3f2fd;
    color: #1976d2;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 15px;
}

.event-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.event-title {
    font-size: 20px;
    font-weight: bold;
    color: #0a1a2f;
    flex: 1;
}

.event-actions {
    display: flex;
    gap: 10px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    font-size: 14px;
}

.btn-edit {
    background: #FFC107;
    color: #000;
}

.btn-delete {
    background: #f44336;
    color: white;
}

.btn-view {
    background: #4CAF50;
    color: white;
}

.btn-manage {
    background: #2196F3;
    color: white;
}

.btn-cancel {
    background: #6c757d;
    color: white;
}

.btn-save {
    background: #0a1a2f;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.event-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #666;
    font-size: 14px;
}

.volunteer-progress {
    margin: 15px 0;
}

.progress-bar {
    background: #e0e0e0;
    border-radius: 10px;
    height: 8px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: #4CAF50;
    border-radius: 10px;
    transition: width 0.3s;
}

.progress-text {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
}

.event-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.event-status {
    font-size: 14px;
}

.highlight {
    background: #fff3cd;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 600;
}

/* Activity Styles */
.activity-item {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    border-left: 3px solid;
}

.activity-new {
    border-left-color: #4CAF50;
    background: #f8fff8;
}

.activity-update {
    border-left-color: #2196F3;
    background: #f8faff;
}

.activity-complete {
    border-left-color: #FF9800;
    background: #fffbf0;
}

.activity-title {
    font-weight: 600;
    margin-bottom: 5px;
    color: #0a1a2f;
}

.activity-meta {
    font-size: 12px;
    color: #666;
}

.create-event-btn {
    background: #0a1a2f;
    color: white;
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.create-event-btn:hover {
    background: #142b4f;
    transform: translateY(-2px);
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}

.modal-content {
    background: white;
    margin: 5% auto;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    max-height: 90vh;
    overflow-y: auto;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group input, .form-group textarea, .form-group select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
    outline: none;
    border-color: #0a1a2f;
    box-shadow: 0 0 0 2px rgba(10, 26, 47, 0.1);
}

.form-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
}

.quick-stats {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
}

.quick-stats h3 {
    margin-bottom: 15px;
    color: #0a1a2f;
}

/* Loading Spinner */
.loading-spinner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    color: white;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0a1a2f;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Error and Success Messages */
.error-message {
    background: #f8d7da;
    color: #721c24;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    border: 1px solid #f5c6cb;
}

.success-message {
    background: #d4edda;
    color: #155724;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
    border: 1px solid #c3e6cb;
}

/* Responsive Design */
@media (max-width: 768px) {
    .navbar {
        padding: 15px 20px;
    }

    .dashboard-container {
        grid-template-columns: 1fr;
        margin: 20px;
        padding: 0 10px;
    }

    .dashboard-hero {
        padding: 25px;
    }

    .hero-content h1 {
        font-size: 2rem;
    }

    .hero-content .organization-name {
        font-size: 1.4rem;
    }

    .stats-grid {
        grid-template-columns: 1fr 1fr;
    }

    .quick-actions {
        flex-direction: column;
    }

    .event-header {
        flex-direction: column;
        gap: 15px;
    }

    .event-actions {
        width: 100%;
        justify-content: flex-start;
    }

    .event-footer {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
    }

    .modal-content {
        margin: 10% auto;
        width: 95%;
        padding: 20px;
    }
}
/* Volunteers Modal Styles */
#volunteersModal .modal-content {
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.volunteers-list {
    margin: 20px 0;
}

.volunteer-item {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.volunteer-item h4 {
    margin: 0 0 10px 0;
    color: #2c3e50;
}

.volunteer-item p {
    margin: 5px 0;
    color: #6c757d;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #000;
}

    </style>
</head>
<body>
      <nav class="navbar">
        <div class="logo">SocioServe</div>
        <div class="nav-links">
            <a href="#" id="organizerName">Organizer</a>
            <a href="index.html">Logout</a>
        </div>
    </nav>
<div class="dashboard-container">
        <div class="events-section">
            <button class="create-event-btn" onclick="openCreateModal()">+ Create New Event</button>
            
            <!-- Dashboard Hero Section -->
            <div id="dashboardHero" class="dashboard-hero">
                <div class="hero-content">
                    <h1>
                        Welcome back, <span id="heroOrganizerName">Organizer</span>!
                    </h1>
                    <span class="organization-name" id="heroOrganizationName">Your Organization</span>
                    <p class="tagline" id="heroTagline">
                        Leading Community Impact - Manage volunteers, events, and track the impact you're creating together.
                        </p>
                        
                        <div class="stats-grid" id="statsGrid">
                            <div class="stat-card">
                                <div class="stat-number" id="totalEvents">0</div>
                                <div class="stat-label">Total Events</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="activeEvents">0</div>
                                <div class="stat-label">Active Events</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="totalVolunteers">0</div>
                                <div class="stat-label">Volunteers Engaged</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="completionRate">0%</div>
                                <div class="stat-label">Completion Rate</div>
                            </div>
                        </div>

                        
                    </div>
                </div>

                <h2>Your Events</h2>
                <div id="eventsList">
                    <!-- Events will be loaded here -->
                </div>
            </div>

            <div class="activity-section">
                <h2>Recent Activity</h2>
                <div id="recentActivity">
                    <!-- Recent activities will be loaded here -->
                </div>
                
                <div class="quick-stats">
                    <h3>Quick Stats</h3>
                    <div id="quickStats">
                        <!-- Quick stats will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Create/Edit Event Modal -->
        <div id="eventModal" class="modal">
            <div class="modal-content">
                <h3 id="modalTitle">Create New Event</h3>
                <form id="eventForm">
                    <input type="hidden" id="eventId">
                    <div class="form-group">
                        <label>Event Title *</label>
                        <input type="text" id="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="eventCategory" required>
                            <option value="">Select Category</option>
                            <option value="Environment">Environment</option>
                            <option value="Education">Education</option>
                            <option value="Health">Health</option>
                            <option value="Community">Community</option>
                            <option value="Animal Welfare">Animal Welfare</option>
                            <option value="Elderly Care">Elderly Care</option>
                            <option value="Disaster Relief">Disaster Relief</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date *</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label>Start Time *</label>
                        <input type="time" id="startTime" required>
                    </div>
                    <div class="form-group">
                        <label>End Time *</label>
                        <input type="time" id="endTime" required>
                    </div>
                    <div class="form-group">
                        <label>Location *</label>
                        <input type="text" id="eventLocation" required>
                    </div>
                    <div class="form-group">
                        <label>Max Volunteers *</label>
                        <input type="number" id="maxVolunteers" required min="1">
                    </div>
                    <div class="form-group">
                        <label>Skills Required</label>
                        <input type="text" id="skillsRequired" placeholder="e.g., Teaching, Gardening, First Aid">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-save">Save Event</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Volunteer Management Modal -->
<div id="volunteersModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header" style="background: #3498db; color: white; padding: 20px; border-radius: 8px 8px 0 0;">
            <h3 id="volunteerModalTitle" style="margin: 0; font-size: 24px;">
                Registered Volunteers
            </h3>
            <span class="close" onclick="closeVolunteersModal()" 
                  style="color: white; font-size: 28px; font-weight: bold; cursor: pointer;">
                &times;
            </span>
        </div>
        
        <div class="modal-body" style="padding: 25px; max-height: 70vh; overflow-y: auto;">
            <!-- Loading State -->
            <div id="volunteersLoading" class="loading" style="display: none; text-align: center; padding: 40px;">
                <div style="font-size: 18px; color: #7f8c8d;">Loading volunteers...</div>
            </div>
            
            <!-- Volunteers Content -->
            <div id="volunteersContent" style="display: none;">
                <div class="volunteer-stats" style="background: #ecf0f1; padding: 15px; border-radius: 6px; margin-bottom: 20px; text-align: center;">
                    <strong style="font-size: 16px; color: #2c3e50;">
                        Total Volunteers: <span id="volunteerCount" style="color: #e74c3c;">0</span>
                    </strong>
                </div>
                
                <div class="volunteers-list" id="volunteersList">
                    <!-- Volunteers will be listed here -->
                </div>
            </div>
            
            <!-- No Volunteers -->
            <div id="noVolunteers" class="no-data" style="display: none; text-align: center; padding: 60px 20px;">
                <div style="font-size: 48px; margin-bottom: 20px;">üë•</div>
                <h3 style="color: #7f8c8d; margin-bottom: 10px;">No Volunteers Yet</h3>
                <p style="color: #95a5a6;">No volunteers have registered for this event yet.</p>
            </div>
            
            <!-- Error State -->
            <div id="volunteersError" class="error-message" style="display: none; text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 20px;">‚ùå</div>
                <h3 style="color: #e74c3c; margin-bottom: 10px;">Error Loading Volunteers</h3>
                <p id="errorDetails" style="color: #c0392b;"></p>
            </div>
        </div>
        
        <div class="modal-footer" style="padding: 20px; text-align: center; border-top: 1px solid #ecf0f1;">
            <button type="button" class="btn btn-cancel" onclick="closeVolunteersModal()"
                    style="background: #95a5a6; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px;">
                Close
            </button>
        </div>
    </div>
</div>

        <button onclick="generateOrganizerReport(currentOrganizerId, 'pdf')" class="btn-report">Download PDF Report</button>
    <button onclick="generateOrganizerReport(currentOrganizerId, 'csv')" class="btn-report">Download CSV Report</button>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>

        <div class="report-section" style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e0e0e0;">
    <h3 style="color: #2c3e50; margin-bottom: 15px;">üìä Download Events Report</h3>
    
    <div class="report-buttons" style="display: flex; gap: 15px; flex-wrap: wrap;">
        <button class="btn-report" onclick="downloadEventsCSV()" 
                style="background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.3s;"
                onmouseover="this.style.background='#218838'" 
                onmouseout="this.style.background='#28a745'">
            üìÑ Download CSV Report
        </button>
        
        <button class="btn-report" onclick="downloadEventsExcel()"
                style="background: #17a2b8; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.3s;"
                onmouseover="this.style.background='#138496'" 
                onmouseout="this.style.background='#17a2b8'">
            üìä Download Excel Report
        </button>
        

    </div>
    
    <div style="margin-top: 10px;">
        <small style="color: #6c757d;">Current Organizer ID: <span id="currentOrgId">Not set</span></small>
    </div>
</div>
   

    <script>
       // Backend API Configuration
const API_BASE = 'http://localhost:8092/api';
let currentOrganizer = "";
let currentOrganization = "";
let currentOrganizerId = 1; // Default organizer ID
let events = [];


// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
   loadOrganizerData();
    loadEvents();
    setupAutoRefresh();
   
});

// Load organizer data from localStorage
function loadOrganizerData() {
    const organizerDataString = localStorage.getItem('organizer');
    console.log('Organizer data from localStorage:', organizerDataString);
    
    if (organizerDataString) {
        try {
            const organizer = JSON.parse(organizerDataString);
            console.log('Parsed organizer data:', organizer);
            
            // Get organizer and organization names
            currentOrganizer = organizer.contactPerson || organizer.organizer || organizer.name || "Organizer";
            currentOrganization = organizer.organizationName || organizer.organization || "Your Organization";
            currentOrganizerId = organizer.id || 1;
            
            console.log('Current Organizer:', currentOrganizer);
            console.log('Current Organization:', currentOrganization);
            console.log('Current Organizer ID:', currentOrganizerId);
            
            // Update the dashboard with organizer info
            updateDashboardHero(currentOrganizer, currentOrganization);
            
            // Update navbar
            const organizerNameElement = document.getElementById('organizerName');
            if (organizerNameElement) {
                organizerNameElement.textContent = currentOrganizer;
            }
            
            // Load events and activities
            loadEvents();
            loadRecentActivities();
            loadQuickStats();
            
        } catch (error) {
            console.error('Error parsing organizer data:', error);
            showError('Invalid organizer data. Please register again.');
        }
    } else {
        console.error('No organizer data found in localStorage');
        showError('No organizer data found. Please register first.');
        // Redirect to registration after 3 seconds
        setTimeout(() => {
            window.location.href = 'organiser-register.html';
        }, 3000);
    }
}

// Update the dashboard hero section with organizer info
function updateDashboardHero(organizerName, organizationName) {
    console.log('Updating dashboard hero with:', organizerName, organizationName);
    
    const heroOrganizerName = document.getElementById('heroOrganizerName');
    const heroOrganizationName = document.getElementById('heroOrganizationName');
    const heroTagline = document.getElementById('heroTagline');
    
    if (heroOrganizerName) heroOrganizerName.textContent = organizerName;
    if (heroOrganizationName) heroOrganizationName.textContent = organizationName;
    if (heroTagline) {
        heroTagline.textContent = `Leading Community Impact - Manage volunteers, events, and track the impact ${organizationName} is creating together.`;
    }
}

// Load events from backend for this organizer
async function loadEvents() {
    try {
        console.log('=== LOAD EVENTS DEBUG ===');
        console.log('Current organizer ID:', currentOrganizerId);
        
        // Try multiple endpoints in order
        let response;
        let eventsData = [];
        
        // Try endpoint 1: Get events by organizer ID
        try {
            console.log('Trying endpoint: /events/organizer/' + currentOrganizerId);
            response = await fetch(`${API_BASE}/events/organizer/${currentOrganizerId}`);
            console.log('Endpoint 1 response status:', response.status);
            
            if (response.ok) {
                eventsData = await response.json();
                console.log('Successfully loaded events from organizer endpoint:', eventsData);
            } else {
                throw new Error(`Endpoint 1 failed: ${response.status}`);
            }
        } catch (error1) {
            console.log('Endpoint 1 failed, trying endpoint 2:', error1.message);
            
            // Try endpoint 2: Get all events
            try {
                console.log('Trying endpoint: /events');
                response = await fetch(`${API_BASE}/events`);
                console.log('Endpoint 2 response status:', response.status);
                
                if (response.ok) {
                    const allEvents = await response.json();
                    // Filter events for current organizer
                    eventsData = allEvents.filter(event => 
                        event.organizerId === currentOrganizerId || 
                        event.organizer === currentOrganizer
                    );
                    console.log('Filtered events for organizer:', eventsData);
                } else {
                    throw new Error(`Endpoint 2 failed: ${response.status}`);
                }
            } catch (error2) {
                console.log('Both endpoints failed, using sample data:', error2.message);
                // Use sample data as fallback
                eventsData = getSampleEvents();
            }
        }
        
        events = eventsData;
        displayEvents(events);
        updateRealTimeStats(events);
        
    } catch (error) {
        console.error('Error loading events:', error);
        // Use sample data as final fallback
        events = getSampleEvents();
        displayEvents(events);
        updateRealTimeStats(events);
        showEventsError('Using demo data. Backend connection failed.');
    }
}

// Display events in the UI
function displayEvents(eventsToDisplay) {
    const eventsList = document.getElementById('eventsList');
    
    if (!eventsList) {
        console.error('eventsList element not found!');
        return;
    }
    
    if (!eventsToDisplay || eventsToDisplay.length === 0) {
        eventsList.innerHTML = `
            <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 12px;">
                <h3 style="color: #666; margin-bottom: 15px;">No Events Yet</h3>
                <p style="color: #888; margin-bottom: 20px;">Create your first event to get started with ${currentOrganization}</p>
                <button class="btn btn-save" onclick="openCreateModal()">Create Your First Event</button>
            </div>
        `;
        return;
    }

    eventsList.innerHTML = eventsToDisplay.map(event => {
        const progressPercentage = event.maxVolunteers > 0 ? 
            Math.round(((event.currentVolunteers || 0) / event.maxVolunteers) * 100) : 0;
        
        return `
            <div class="event-card ${event.status ? event.status.toLowerCase() : 'upcoming'}">
                <div class="organization-badge">
                    üè¢ ${event.organization || currentOrganization}
                </div>
                <div class="event-header">
                    <div class="event-title">${event.title || 'Untitled Event'}</div>
                    <div class="event-actions">
                        <button class="btn btn-edit" onclick="editEvent(${event.id})">Edit</button>
                        <button class="btn btn-delete" onclick="deleteEvent(${event.id})">Delete</button>
                    </div>
                </div>
                <div class="event-meta">
                    <div class="meta-item">${event.category || 'General'} | Organized by ${event.organizer || currentOrganizer}</div>
                </div>
                <div class="event-meta">
                    <div class="meta-item">üìÖ ${formatDate(event.eventDate)}</div>
                    <div class="meta-item">‚è∞ ${formatTime(event.startTime)} - ${formatTime(event.endTime)}</div>
                    <div class="meta-item">üìç ${event.location || 'TBD'}</div>
                </div>
                <div class="volunteer-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                    </div>
                    <div class="progress-text">${event.currentVolunteers || 0}/${event.maxVolunteers || 0} volunteers (${progressPercentage}%)</div>
                </div>
                <div class="event-footer">
                    <div class="event-status">Status: <span class="highlight">${event.status || 'UPCOMING'}</span></div>
                    <div class="card-actions">
                        <button onclick="viewEventDetails(${event.id})" class="btn-view">View Details</button>
                       <button class="btn-manage" 
        onclick="manageVolunteers(${event.id}, '${event.title.replace(/'/g, "\\'")}')"
        ${event.currentVolunteers > 0 ? '' : 'disabled'}>
    Manage Volunteers ${event.currentVolunteers > 0 ? `(${event.currentVolunteers})` : ''}
</button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// Update real-time stats
function updateRealTimeStats(events) {
    const totalEvents = events.length;
    const activeEvents = events.filter(event => 
        event.status === 'UPCOMING' || event.status === 'ONGOING'
    ).length;
    const totalVolunteers = events.reduce((sum, event) => 
        sum + (event.currentVolunteers || 0), 0
    );
    const completedEvents = events.filter(event => 
        event.status === 'COMPLETED'
    ).length;
    const completionRate = totalEvents > 0 ? 
        Math.round((completedEvents / totalEvents) * 100) : 0;

    // Update stat numbers
    const totalEventsEl = document.getElementById('totalEvents');
    const activeEventsEl = document.getElementById('activeEvents');
    const totalVolunteersEl = document.getElementById('totalVolunteers');
    const completionRateEl = document.getElementById('completionRate');

    if (totalEventsEl) totalEventsEl.textContent = totalEvents;
    if (activeEventsEl) activeEventsEl.textContent = activeEvents;
    if (totalVolunteersEl) totalVolunteersEl.textContent = totalVolunteers;
    if (completionRateEl) completionRateEl.textContent = completionRate + '%';
}

// Create new event
async function createEvent(eventData) {
    try {
        showLoading(true);
        
        // Auto-fill organizer and organization from registration data
        eventData.organizer = currentOrganizer;
        eventData.organization = currentOrganization;
        eventData.organizerId = currentOrganizerId;
        eventData.currentVolunteers = 0;
        eventData.status = 'UPCOMING';
        
        // Ensure time fields are properly formatted
        if (eventData.startTime && !eventData.startTime.includes(':')) {
            eventData.startTime += ':00';
        }
        if (eventData.endTime && !eventData.endTime.includes(':')) {
            eventData.endTime += ':00';
        }
        
        console.log('Creating event with data:', eventData);
        
        const response = await fetch(`${API_BASE}/events`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(eventData)
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || `HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        
        closeModal();
        loadEvents();
        loadRecentActivities();
        
        showSuccessMessage('üéâ Event created successfully!');
        
    } catch (error) {
        console.error('Error creating event:', error);
        showErrorMessage('‚ùå Error creating event: ' + error.message);
    } finally {
        showLoading(false);
    }
}

// Update existing event
async function updateEvent(id, eventData) {
    try {
        showLoading(true);
        
        console.log('Updating event:', id, eventData);
        
        const response = await fetch(`${API_BASE}/events/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(eventData)
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || `HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        
        closeModal();
        loadEvents();
        loadRecentActivities();
        
        showSuccessMessage('‚úÖ Event updated successfully!');
        
    } catch (error) {
        console.error('Error updating event:', error);
        showErrorMessage('‚ùå Error updating event: ' + error.message);
    } finally {
        showLoading(false);
    }
}

// Delete event
async function deleteEvent(id) {
    if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
        try {
            showLoading(true);
            
            const response = await fetch(`${API_BASE}/events/${id}`, {
                method: 'DELETE'
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            loadEvents();
            loadRecentActivities();
            
            showSuccessMessage('‚úÖ Event deleted successfully!');
            
        } catch (error) {
            console.error('Error deleting event:', error);
            showErrorMessage('‚ùå Error deleting event: ' + error.message);
        } finally {
            showLoading(false);
        }
    }
}

// View event details
async function viewEventDetails(eventId) {
    try {
        const response = await fetch(`${API_BASE}/events/${eventId}`);
        
        if (response.ok) {
            const event = await response.json();
            showEventDetailsModal(event);
        } else {
            throw new Error('Event not found');
        }
    } catch (error) {
        console.error('Error loading event details:', error);
        showErrorMessage('Error loading event details');
    }
}

// Show event details in modal
function showEventDetailsModal(event) {
    const modalHTML = `
        <div id="eventDetailsModal" class="modal" style="display: block;">
            <div class="modal-content">
                <span class="close" onclick="closeEventDetailsModal()">&times;</span>
                <h3>${event.title}</h3>
                <div style="margin: 20px 0;">
                    <p><strong>Description:</strong> ${event.description || 'No description'}</p>
                    <p><strong>Category:</strong> ${event.category}</p>
                    <p><strong>Date:</strong> ${formatDate(event.eventDate)}</p>
                    <p><strong>Time:</strong> ${formatTime(event.startTime)} - ${formatTime(event.endTime)}</p>
                    <p><strong>Location:</strong> ${event.location}</p>
                    <p><strong>Volunteers:</strong> ${event.currentVolunteers || 0}/${event.maxVolunteers}</p>
                    ${event.skillsRequired ? `<p><strong>Skills Required:</strong> ${event.skillsRequired}</p>` : ''}
                </div>
                <button onclick="closeEventDetailsModal()" class="btn btn-cancel">Close</button>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeEventDetailsModal() {
    const modal = document.getElementById('eventDetailsModal');
    if (modal) modal.remove();
}

// Function to handle "Manage Volunteers" button click
function manageVolunteers(eventId, eventTitle) {
    console.log('üîç Managing volunteers for event:', eventId, eventTitle);
    
    // Show loading state
    document.getElementById('volunteersLoading').style.display = 'block';
    document.getElementById('volunteersContent').style.display = 'none';
    document.getElementById('noVolunteers').style.display = 'none';
    document.getElementById('volunteersError').style.display = 'none';
    
    // Update modal title
    document.getElementById('volunteerModalTitle').textContent = `Registered Volunteers - ${eventTitle}`;
    
    // Use the correct port 8082 and endpoint
    const apiUrl = `http://localhost:8092/api/volunteer-registrations/event/${eventId}/volunteers`;
    console.log('üåê Calling API:', apiUrl);
    
    fetch(apiUrl)
        .then(response => {
            console.log('üì® Response status:', response.status);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(volunteers => {
            console.log('üìä Volunteers data received:', volunteers);
            document.getElementById('volunteersLoading').style.display = 'none';
            
            if (volunteers && volunteers.length > 0) {
                displayVolunteers(volunteers, eventTitle);
            } else {
                document.getElementById('noVolunteers').style.display = 'block';
            }
        })
        .catch(error => {
            console.error('‚ùå Fetch error:', error);
            document.getElementById('volunteersLoading').style.display = 'none';
            showVolunteersError('Error loading volunteers: ' + error.message);
        });
    
    // Show the modal
    document.getElementById('volunteersModal').style.display = 'block';
}

    
 
// Enhanced display function to match your desired format
function displayVolunteers(volunteers, eventTitle) {
    const volunteersList = document.getElementById('volunteersList');
    const volunteersContent = document.getElementById('volunteersContent');
    
    // Update modal title again to ensure it's set
    document.getElementById('volunteerModalTitle').textContent = `Registered Volunteers - ${eventTitle}`;
    
    // Update volunteer count
    document.getElementById('volunteerCount').textContent = volunteers.length;
    
    volunteersList.innerHTML = '';
    
    volunteers.forEach((volunteer, index) => {
        const volunteerItem = document.createElement('div');
        volunteerItem.className = 'volunteer-item';
        volunteerItem.style.cssText = `
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        `;
        
        // Format registration date properly
        let regDate = 'Not available';
        if (volunteer.registrationDate) {
            const date = new Date(volunteer.registrationDate);
            regDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        volunteerItem.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="flex: 1;">
                    <div style="font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">
                        ${volunteer.name || 'Unknown Volunteer'}
                    </div>
                    <div style="color: #7f8c8d; margin-bottom: 5px;">
                        <strong>Email:</strong> ${volunteer.email || 'No email'}
                    </div>
                    <div style="color: #7f8c8d; margin-bottom: 5px;">
                        <strong>Phone:</strong> ${volunteer.phone || 'Not provided'}
                    </div>
                    ${volunteer.skills ? `
                    <div style="color: #7f8c8d; margin-bottom: 5px;">
                        <strong>Skills:</strong> ${volunteer.skills}
                    </div>
                    ` : ''}
                    <div style="color: #95a5a6; font-size: 12px; margin-top: 10px;">
                        <strong>Registration Date:</strong> ${regDate}
                    </div>
                </div>
                <div style="color: #bdc3c7; font-size: 14px; margin-left: 15px;">
                    #${index + 1}
                </div>
            </div>
        `;
        volunteersList.appendChild(volunteerItem);
    });
    
    volunteersContent.style.display = 'block';
    document.getElementById('noVolunteers').style.display = 'none';
}
// Utility functions
function showLoading(show) {
    // Implement your loading indicator
    console.log('Loading:', show);
}

function showError(message) {
    // Implement your error display
    alert('Error: ' + message);
}
function closeVolunteersModal() {
    console.log('Closing volunteers modal');
    document.getElementById('volunteersModal').style.display = 'none';
    
    // Reset all states
    document.getElementById('volunteersLoading').style.display = 'none';
    document.getElementById('volunteersContent').style.display = 'none';
    document.getElementById('noVolunteers').style.display = 'none';
    document.getElementById('volunteersError').style.display = 'none';
}


// Modal functions
function openCreateModal() {
    document.getElementById('modalTitle').textContent = 'Create New Event';
    document.getElementById('eventForm').reset();
    document.getElementById('eventId').value = '';
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('eventDate').min = today;
    
    document.getElementById('eventModal').style.display = 'block';
}

async function editEvent(id) {
    try {
        showLoading(true);
        
        const response = await fetch(`${API_BASE}/events/${id}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const event = await response.json();
        
        document.getElementById('modalTitle').textContent = 'Edit Event';
        document.getElementById('eventId').value = event.id;
        document.getElementById('eventTitle').value = event.title || '';
        document.getElementById('eventDescription').value = event.description || '';
        document.getElementById('eventCategory').value = event.category || '';
        document.getElementById('eventDate').value = event.eventDate || '';
        document.getElementById('startTime').value = event.startTime || '';
        document.getElementById('endTime').value = event.endTime || '';
        document.getElementById('eventLocation').value = event.location || '';
        document.getElementById('maxVolunteers').value = event.maxVolunteers || '';
        document.getElementById('skillsRequired').value = event.skillsRequired || '';
        
        document.getElementById('eventModal').style.display = 'block';
        
    } catch (error) {
        console.error('Error loading event for edit:', error);
        showErrorMessage('Error loading event details');
    } finally {
        showLoading(false);
    }
}

function closeModal() {
    document.getElementById('eventModal').style.display = 'none';
}

// Form submission handler
document.getElementById('eventForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const eventData = {
        title: document.getElementById('eventTitle').value.trim(),
        description: document.getElementById('eventDescription').value.trim(),
        category: document.getElementById('eventCategory').value,
        eventDate: document.getElementById('eventDate').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        location: document.getElementById('eventLocation').value.trim(),
        maxVolunteers: parseInt(document.getElementById('maxVolunteers').value),
        skillsRequired: document.getElementById('skillsRequired').value.trim()
    };

    // Validate required fields
    if (!eventData.title || !eventData.category || !eventData.eventDate || 
        !eventData.startTime || !eventData.endTime || !eventData.location || 
        !eventData.maxVolunteers) {
        showErrorMessage('Please fill in all required fields.');
        return;
    }

    // Validate date is not in the past
    const eventDate = new Date(eventData.eventDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    if (eventDate < today) {
        showErrorMessage('Event date cannot be in the past.');
        return;
    }

    // Validate time
    if (eventData.startTime >= eventData.endTime) {
        showErrorMessage('End time must be after start time.');
        return;
    }

    const eventId = document.getElementById('eventId').value;
    
    if (eventId) {
        updateEvent(eventId, eventData);
    } else {
        createEvent(eventData);
    }
});

// Alternative method using fetch
function downloadEventsExcel() {
    if (!currentOrganizerId) {
        alert('Please log in as an organizer first.');
        return;
    }
    
    console.log('Downloading Excel report for organizer:', currentOrganizerId);
    
    const url = `http://localhost:8092/api/reports/organizer/${currentOrganizerId}/events/excel`;
    
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.blob();
        })
        .then(blob => {
            // Create download link
            const downloadUrl = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = 'my-events-report.xlsx';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(downloadUrl);
        })
        .catch(error => {
            console.error('Download failed:', error);
            alert('Download failed: ' + error.message);
        });
}

function downloadEventsCSV() {
    if (!currentOrganizerId) {
        alert('Please log in as an organizer first.');
        return;
    }
    
    console.log('Downloading CSV report for organizer:', currentOrganizerId);
    
    const url = `http://localhost:8092/api/reports/organizer/${currentOrganizerId}/events/csv`;
    
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.blob();
        })
        .then(blob => {
            // Create download link
            const downloadUrl = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = 'my-events-report.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(downloadUrl);
        })
        .catch(error => {
            console.error('Download failed:', error);
            alert('Download failed: ' + error.message);
        });
}
// Utility functions
function formatDate(dateString) {
    if (!dateString) return 'TBD';
    try {
        return new Date(dateString).toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric',
            month: 'long', 
            day: 'numeric' 
        });
    } catch (error) {
        return 'Invalid Date';
    }
}

function formatTime(timeString) {
    if (!timeString) return 'TBD';
    try {
        return new Date(`2000-01-01T${timeString}`).toLocaleTimeString('en-US', { 
            hour: 'numeric', 
            minute: '2-digit',
            hour12: true 
        });
    } catch (error) {
        return 'Invalid Time';
    }
}

function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    if (spinner) {
        spinner.style.display = show ? 'flex' : 'none';
    }
}

function showSuccessMessage(message) {
    alert(message);
}

function showErrorMessage(message) {
    alert(message);
}



// Load recent activities (placeholder)
async function loadRecentActivities() {
    try {
        // This would call your backend API for activities
        // For now, use placeholder data
        displayRecentActivities(getSampleActivities());
    } catch (error) {
        console.error('Error loading activities:', error);
        displayRecentActivities(getSampleActivities());
    }
}

function getSampleActivities() {
    return [
        {
            title: "New event created: NSS BEACH DRIVE",
            createdAt: new Date().toISOString(),
            currentVolunteers: 3
        },
        {
            title: "Volunteer registered for NSS BLOOD CAMP",
            createdAt: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
            currentVolunteers: 2
        }
    ];
}

function displayRecentActivities(activities) {
    const activityContainer = document.getElementById('recentActivity');
    
    if (!activities || activities.length === 0) {
        activityContainer.innerHTML = `
            <div class="activity-item">
                <div class="activity-title">No recent activity</div>
                <div class="activity-meta">Create your first event to see activity here</div>
            </div>
        `;
        return;
    }

    activityContainer.innerHTML = activities.map(activity => `
        <div class="activity-item activity-new">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-meta">${formatDate(activity.createdAt)} ‚Ä¢ ${activity.currentVolunteers} volunteers</div>
        </div>
    `).join('');
}

// Load quick stats
function loadQuickStats() {
    const quickStats = document.getElementById('quickStats');
    if (quickStats) {
        const upcomingCount = events.filter(event => event.status === 'UPCOMING').length;
        const completedCount = events.filter(event => event.status === 'COMPLETED').length;
        
        quickStats.innerHTML = `
            <div style="margin-bottom: 15px;">
                <strong>üìà This Month</strong>
                <p style="margin: 5px 0; font-size: 14px;">Events created: <span id="monthEvents">${events.length}</span></p>
            </div>
            <div style="margin-bottom: 15px;">
                <strong>üë• Volunteer Growth</strong>
                <p style="margin: 5px 0; font-size: 14px;">Total volunteers: <span id="totalVolunteersCount">${events.reduce((sum, event) => sum + (event.currentVolunteers || 0), 0)}</span></p>
            </div>
            <div>
                <strong>üéØ Upcoming Events</strong>
                <p style="margin: 5px 0; font-size: 14px;" id="upcomingEvents">${upcomingCount} events</p>
            </div>
        `;
    }
}

// Error handling
function showError(message) {
    const eventsSection = document.querySelector('.events-section');
    if (eventsSection) {
        eventsSection.innerHTML = `
            <div class="error-message">
                <h3>‚ö†Ô∏è Error</h3>
                <p>${message}</p>
                <button onclick="window.location.href='organiser-register.html'" 
                        class="btn btn-save" style="margin-top: 10px;">
                    Register Again
                </button>
            </div>
        `;
    }
}

function showEventsError(errorMessage) {
    const eventsList = document.getElementById('eventsList');
    if (eventsList) {
        eventsList.innerHTML = `
            <div class="error-message">
                <p>${errorMessage}</p>
                <button class="btn btn-save" onclick="loadEvents()" style="margin-top: 15px;">Retry</button>
            </div>
        `;
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('eventModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Add this CSS for the new elements
const additionalStyles = `
.card-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn-view, .btn-manage {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s ease;
}

.btn-view {
    background: #3498db;
    color: white;
}

.btn-manage {
    background: #27ae60;
    color: white;
}

.btn-view:hover {
    background: #2980b9;
}

.btn-manage:hover {
    background: #219a52;
}

.report-buttons {
    display: flex;
    gap: 10px;
    margin: 20px 0;
}

.btn-report {
    padding: 10px 20px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.btn-report:hover {
    background: #c0392b;
}
`;

// Inject additional styles
const styleSheet = document.createElement('style');
styleSheet.textContent = additionalStyles;
document.head.appendChild(styleSheet);

// Update the report buttons in your HTML to use the new function
// Change: onclick="generateOrganizerReport(currentOrganizerId, 'pdf')"
// To: onclick="generateOrganizerReport('pdf')"


// Handle page refresh
window.addEventListener('beforeunload', function() {
    // You can add any cleanup code here if needed
});
    </script>
</body>
</html>